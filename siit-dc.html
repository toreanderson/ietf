<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" 
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">

<html lang="en" xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head profile="http://www.w3.org/2006/03/hcard http://dublincore.org/documents/2008/08/04/dc-html/">
  <meta http-equiv="Content-Type" content="text/html; charset=us-ascii" />

  <title>SIIT-DC: Stateless IP/ICMP Translation for IPv6 Data Centre Environments</title>

  <style type="text/css" title="Xml2Rfc (sans serif)">
  /*<![CDATA[*/
	  a {
	  text-decoration: none;
	  }
	  a.smpl {
	  color: black;
	  }
	  a:hover {
	  text-decoration: underline;
	  }
	  a:active {
	  text-decoration: underline;
	  }
	  address {
	  margin-top: 1em;
	  margin-left: 2em;
	  font-style: normal;
	  }
	  body {
	  color: black;
	  font-family: verdana, helvetica, arial, sans-serif;
	  font-size: 10pt;
	  max-width: 55em;
	  
	  }
	  cite {
	  font-style: normal;
	  }
	  dd {
	  margin-right: 2em;
	  }
	  dl {
	  margin-left: 2em;
	  }
	
	  ul.empty {
	  list-style-type: none;
	  }
	  ul.empty li {
	  margin-top: .5em;
	  }
	  dl p {
	  margin-left: 0em;
	  }
	  dt {
	  margin-top: .5em;
	  }
	  h1 {
	  font-size: 14pt;
	  line-height: 21pt;
	  page-break-after: avoid;
	  }
	  h1.np {
	  page-break-before: always;
	  }
	  h1 a {
	  color: #333333;
	  }
	  h2 {
	  font-size: 12pt;
	  line-height: 15pt;
	  page-break-after: avoid;
	  }
	  h3, h4, h5, h6 {
	  font-size: 10pt;
	  page-break-after: avoid;
	  }
	  h2 a, h3 a, h4 a, h5 a, h6 a {
	  color: black;
	  }
	  img {
	  margin-left: 3em;
	  }
	  li {
	  margin-left: 2em;
	  margin-right: 2em;
	  }
	  ol {
	  margin-left: 2em;
	  margin-right: 2em;
	  }
	  ol p {
	  margin-left: 0em;
	  }
	  p {
	  margin-left: 2em;
	  margin-right: 2em;
	  }
	  pre {
	  margin-left: 3em;
	  background-color: lightyellow;
	  padding: .25em;
	  }
	  pre.text2 {
	  border-style: dotted;
	  border-width: 1px;
	  background-color: #f0f0f0;
	  width: 69em;
	  }
	  pre.inline {
	  background-color: white;
	  padding: 0em;
	  }
	  pre.text {
	  border-style: dotted;
	  border-width: 1px;
	  background-color: #f8f8f8;
	  width: 69em;
	  }
	  pre.drawing {
	  border-style: solid;
	  border-width: 1px;
	  background-color: #f8f8f8;
	  padding: 2em;
	  }
	  table {
	  margin-left: 2em;
	  }
	  table.tt {
	  vertical-align: top;
	  }
	  table.full {
	  border-style: outset;
	  border-width: 1px;
	  }
	  table.headers {
	  border-style: outset;
	  border-width: 1px;
	  }
	  table.tt td {
	  vertical-align: top;
	  }
	  table.full td {
	  border-style: inset;
	  border-width: 1px;
	  }
	  table.tt th {
	  vertical-align: top;
	  }
	  table.full th {
	  border-style: inset;
	  border-width: 1px;
	  }
	  table.headers th {
	  border-style: none none inset none;
	  border-width: 1px;
	  }
	  table.left {
	  margin-right: auto;
	  }
	  table.right {
	  margin-left: auto;
	  }
	  table.center {
	  margin-left: auto;
	  margin-right: auto;
	  }
	  caption {
	  caption-side: bottom;
	  font-weight: bold;
	  font-size: 9pt;
	  margin-top: .5em;
	  }
	
	  table.header {
	  border-spacing: 1px;
	  width: 95%;
	  font-size: 10pt;
	  color: white;
	  }
	  td.top {
	  vertical-align: top;
	  }
	  td.topnowrap {
	  vertical-align: top;
	  white-space: nowrap; 
	  }
	  table.header td {
	  background-color: gray;
	  width: 50%;
	  }
	  table.header a {
	  color: white;
	  }
	  td.reference {
	  vertical-align: top;
	  white-space: nowrap;
	  padding-right: 1em;
	  }
	  thead {
	  display:table-header-group;
	  }
	  ul.toc, ul.toc ul {
	  list-style: none;
	  margin-left: 1.5em;
	  margin-right: 0em;
	  padding-left: 0em;
	  }
	  ul.toc li {
	  line-height: 150%;
	  font-weight: bold;
	  font-size: 10pt;
	  margin-left: 0em;
	  margin-right: 0em;
	  }
	  ul.toc li li {
	  line-height: normal;
	  font-weight: normal;
	  font-size: 9pt;
	  margin-left: 0em;
	  margin-right: 0em;
	  }
	  li.excluded {
	  font-size: 0pt;
	  }
	  ul p {
	  margin-left: 0em;
	  }
	
	  .comment {
	  background-color: yellow;
	  }
	  .center {
	  text-align: center;
	  }
	  .error {
	  color: red;
	  font-style: italic;
	  font-weight: bold;
	  }
	  .figure {
	  font-weight: bold;
	  text-align: center;
	  font-size: 9pt;
	  }
	  .filename {
	  color: #333333;
	  font-weight: bold;
	  font-size: 12pt;
	  line-height: 21pt;
	  text-align: center;
	  }
	  .fn {
	  font-weight: bold;
	  }
	  .hidden {
	  display: none;
	  }
	  .left {
	  text-align: left;
	  }
	  .right {
	  text-align: right;
	  }
	  .title {
	  color: #990000;
	  font-size: 18pt;
	  line-height: 18pt;
	  font-weight: bold;
	  text-align: center;
	  margin-top: 36pt;
	  }
	  .vcardline {
	  display: block;
	  }
	  .warning {
	  font-size: 14pt;
	  background-color: yellow;
	  }
	
	
	  @media print {
	  .noprint {
		display: none;
	  }
	
	  a {
		color: black;
		text-decoration: none;
	  }
	
	  table.header {
		width: 90%;
	  }
	
	  td.header {
		width: 50%;
		color: black;
		background-color: white;
		vertical-align: top;
		font-size: 12pt;
	  }
	
	  ul.toc a::after {
		content: leader('.') target-counter(attr(href), page);
	  }
	
	  ul.ind li li a {
		content: target-counter(attr(href), page);
	  }
	
	  .print2col {
		column-count: 2;
		-moz-column-count: 2;
		column-fill: auto;
	  }
	  }
	
	  @page {
	  @top-left {
		   content: "Internet-Draft"; 
	  } 
	  @top-right {
		   content: "December 2010"; 
	  } 
	  @top-center {
		   content: "Abbreviated Title";3
	  } 
	  @bottom-left {
		   content: "Doe"; 
	  } 
	  @bottom-center {
		   content: "Expires June 2011"; 
	  } 
	  @bottom-right {
		   content: "[Page " counter(page) "]"; 
	  } 
	  }
	
	  @page:first { 
		@top-left {
		  content: normal;
		}
		@top-right {
		  content: normal;
		}
		@top-center {
		  content: normal;
		}
	  }
  /*]]>*/
  </style>

  <link href="#rfc.toc" rel="Contents"/>
<link href="#rfc.section.1" rel="Chapter" title="1 Introduction"/>
<link href="#rfc.section.1.1" rel="Chapter" title="1.1 Motivation and Goals"/>
<link href="#rfc.section.1.1.1" rel="Chapter" title="1.1.1 Single Stack IPv6 Operation"/>
<link href="#rfc.section.1.1.2" rel="Chapter" title="1.1.2 Stateless Operation"/>
<link href="#rfc.section.1.1.3" rel="Chapter" title="1.1.3 IPv4 Address Conservation"/>
<link href="#rfc.section.1.1.4" rel="Chapter" title="1.1.4 No Loss of End User's Source Address"/>
<link href="#rfc.section.1.1.5" rel="Chapter" title="1.1.5 No Forklift Upgrades Required"/>
<link href="#rfc.section.1.1.6" rel="Chapter" title="1.1.6 No Architectural Dependency on IPv4"/>
<link href="#rfc.section.2" rel="Chapter" title="2 Terminology"/>
<link href="#rfc.section.3" rel="Chapter" title="3 Architectural Overview"/>
<link href="#rfc.section.3.1" rel="Chapter" title="3.1 DNS Configuration"/>
<link href="#rfc.section.3.2" rel="Chapter" title="3.2 Packet Flow"/>
<link href="#rfc.section.4" rel="Chapter" title="4 Deployment Guidelines"/>
<link href="#rfc.section.4.1" rel="Chapter" title="4.1 Application Support for NAT"/>
<link href="#rfc.section.4.2" rel="Chapter" title="4.2 Application Support for IPv6"/>
<link href="#rfc.section.4.3" rel="Chapter" title="4.3 Application Communication Pattern"/>
<link href="#rfc.section.4.4" rel="Chapter" title="4.4 Choice of Translation Prefix"/>
<link href="#rfc.section.4.5" rel="Chapter" title="4.5 Routing Considerations"/>
<link href="#rfc.section.4.6" rel="Chapter" title="4.6 Location of the SIIT-DC Gateways"/>
<link href="#rfc.section.4.7" rel="Chapter" title="4.7 Migration from Dual Stack"/>
<link href="#rfc.section.4.8" rel="Chapter" title="4.8 Packet Size and Fragmentation Considerations"/>
<link href="#rfc.section.4.8.1" rel="Chapter" title="4.8.1 IP Header Size Difference"/>
<link href="#rfc.section.4.8.2" rel="Chapter" title="4.8.2 Minimum Path MTU Difference"/>
<link href="#rfc.section.4.8.3" rel="Chapter" title="4.8.3 &quot;Atomic Fragments&quot;"/>
<link href="#rfc.section.5" rel="Chapter" title="5 Implementation Requirements"/>
<link href="#rfc.section.5.1" rel="Chapter" title="5.1 Compliance with RFC6145 and RFC6052"/>
<link href="#rfc.section.5.2" rel="Chapter" title="5.2 Static Address Mapping Function"/>
<link href="#rfc.section.5.3" rel="Chapter" title="5.3 Support for Increasing the IPv6 Path MTU"/>
<link href="#rfc.section.5.4" rel="Chapter" title="5.4 Support for Disabling &quot;Atomic Fragments&quot;"/>
<link href="#rfc.section.5.5" rel="Chapter" title="5.5 Feature for Handling IPv4 Path MTUs Lower than 1260"/>
<link href="#rfc.section.5.6" rel="Chapter" title="5.6 Feature for Setting the IPv6 Flow Label"/>
<link href="#rfc.section.5.7" rel="Chapter" title="5.7 Loop Prevention Mechanism"/>
<link href="#rfc.section.6" rel="Chapter" title="6 Acknowledgements"/>
<link href="#rfc.section.7" rel="Chapter" title="7 Requirements Language"/>
<link href="#rfc.section.8" rel="Chapter" title="8 IANA Considerations"/>
<link href="#rfc.section.9" rel="Chapter" title="9 Security Considerations"/>
<link href="#rfc.section.9.1" rel="Chapter" title="9.1 Mistaking the Translation Prefix for a Trusted Network"/>
<link href="#rfc.section.9.2" rel="Chapter" title="9.2 Packets Looping Through the SIIT-DC Function"/>
<link href="#rfc.references" rel="Chapter" title="10 References"/>
<link href="#rfc.references.1" rel="Chapter" title="10.1 Normative References"/>
<link href="#rfc.references.2" rel="Chapter" title="10.2 Informative References"/>
<link href="#rfc.appendix.A" rel="Chapter" title="A Complete SIIT-DC topology example"/>
<link href="#rfc.appendix.B" rel="Chapter" title="B Comparison to Other Deployment Approaches"/>
<link href="#rfc.appendix.B.1" rel="Chapter" title="B.1 IPv4-only"/>
<link href="#rfc.appendix.B.2" rel="Chapter" title="B.2 IPv4-only + NAPT44"/>
<link href="#rfc.appendix.B.3" rel="Chapter" title="B.3 IPv4-only + NAT64"/>
<link href="#rfc.appendix.B.4" rel="Chapter" title="B.4 Dual Stack"/>
<link href="#rfc.authors" rel="Chapter"/>


  <meta name="generator" content="xml2rfc version 2.4.2 - http://tools.ietf.org/tools/xml2rfc" />
  <link rel="schema.dct" href="http://purl.org/dc/terms/" />

  <meta name="dct.creator" content="Anderson, T." />
  <meta name="dct.identifier" content="urn:ietf:id:draft-anderson-v6ops-siit-dc-00" />
  <meta name="dct.issued" scheme="ISO8601" content="2014-10-03" />
  <meta name="dct.abstract" content="This document describes SIIT-DC, an extension to " />
  <meta name="description" content="This document describes SIIT-DC, an extension to " />

</head>

<body>

  <table class="header">
    <tbody>
    
    	<tr>
  <td class="left">IPv6 Operations</td>
  <td class="right">T. Anderson</td>
</tr>
<tr>
  <td class="left">Internet-Draft</td>
  <td class="right">Redpill Linpro</td>
</tr>
<tr>
  <td class="left">Intended status: Standards Track</td>
  <td class="right">October 03, 2014</td>
</tr>
<tr>
  <td class="left">Expires: April 06, 2015</td>
  <td class="right"></td>
</tr>

    	
    </tbody>
  </table>

  <p class="title">SIIT-DC: Stateless IP/ICMP Translation for IPv6 Data Centre Environments<br />
  <span class="filename">draft-anderson-v6ops-siit-dc-00</span></p>
  
  <h1 id="rfc.abstract">
  <a href="#rfc.abstract">Abstract</a>
</h1>
<p>This document describes SIIT-DC, an extension to <a href="#RFC6145">Stateless IP/ICMP Translation (SIIT)</a> <cite title="NONE">[RFC6145]</cite> that makes it ideally suited for use in IPv6 data centre environments. SIIT-DC simultaneously facilitates IPv6 deployment and IPv4 address conservation. The overall SIIT-DC architecture is described, as well as guidelines for operators.  Finally, the normative implementation requirements are described, as a list of additions and changes to <a href="#RFC6145">SIIT</a> <cite title="NONE">[RFC6145]</cite>.  </p>
<h1 id="rfc.status">
  <a href="#rfc.status">Status of This Memo</a>
</h1>
<p>This Internet-Draft is submitted in full conformance with the provisions of BCP 78 and BCP 79.</p>
<p>Internet-Drafts are working documents of the Internet Engineering Task Force (IETF).  Note that other groups may also distribute working documents as Internet-Drafts.  The list of current Internet-Drafts is at http://datatracker.ietf.org/drafts/current/.</p>
<p>Internet-Drafts are draft documents valid for a maximum of six months and may be updated, replaced, or obsoleted by other documents at any time.  It is inappropriate to use Internet-Drafts as reference material or to cite them other than as "work in progress."</p>
<p>This Internet-Draft will expire on April 06, 2015.</p>
<h1 id="rfc.copyrightnotice">
  <a href="#rfc.copyrightnotice">Copyright Notice</a>
</h1>
<p>Copyright (c) 2014 IETF Trust and the persons identified as the document authors.  All rights reserved.</p>
<p>This document is subject to BCP 78 and the IETF Trust's Legal Provisions Relating to IETF Documents (http://trustee.ietf.org/license-info) in effect on the date of publication of this document.  Please review these documents carefully, as they describe your rights and restrictions with respect to this document.  Code Components extracted from this document must include Simplified BSD License text as described in Section 4.e of the Trust Legal Provisions and are provided without warranty as described in the Simplified BSD License.</p>

  
  <hr class="noprint" />
  <h1 class="np" id="rfc.toc"><a href="#rfc.toc">Table of Contents</a></h1>
  <ul class="toc">

  	<li>1.   <a href="#rfc.section.1">Introduction</a></li>
<li>1.1.   <a href="#rfc.section.1.1">Motivation and Goals</a></li>
<li>1.1.1.   <a href="#rfc.section.1.1.1">Single Stack IPv6 Operation</a></li>
<li>1.1.2.   <a href="#rfc.section.1.1.2">Stateless Operation</a></li>
<li>1.1.3.   <a href="#rfc.section.1.1.3">IPv4 Address Conservation</a></li>
<li>1.1.4.   <a href="#rfc.section.1.1.4">No Loss of End User's Source Address</a></li>
<li>1.1.5.   <a href="#rfc.section.1.1.5">No Forklift Upgrades Required</a></li>
<li>1.1.6.   <a href="#rfc.section.1.1.6">No Architectural Dependency on IPv4</a></li>
<li>2.   <a href="#rfc.section.2">Terminology</a></li>
<li>3.   <a href="#rfc.section.3">Architectural Overview</a></li>
<li>3.1.   <a href="#rfc.section.3.1">DNS Configuration</a></li>
<li>3.2.   <a href="#rfc.section.3.2">Packet Flow</a></li>
<li>4.   <a href="#rfc.section.4">Deployment Guidelines</a></li>
<li>4.1.   <a href="#rfc.section.4.1">Application Support for NAT</a></li>
<li>4.2.   <a href="#rfc.section.4.2">Application Support for IPv6</a></li>
<li>4.3.   <a href="#rfc.section.4.3">Application Communication Pattern</a></li>
<li>4.4.   <a href="#rfc.section.4.4">Choice of Translation Prefix</a></li>
<li>4.5.   <a href="#rfc.section.4.5">Routing Considerations</a></li>
<li>4.6.   <a href="#rfc.section.4.6">Location of the SIIT-DC Gateways</a></li>
<li>4.7.   <a href="#rfc.section.4.7">Migration from Dual Stack</a></li>
<li>4.8.   <a href="#rfc.section.4.8">Packet Size and Fragmentation Considerations</a></li>
<li>4.8.1.   <a href="#rfc.section.4.8.1">IP Header Size Difference</a></li>
<li>4.8.2.   <a href="#rfc.section.4.8.2">Minimum Path MTU Difference</a></li>
<li>4.8.3.   <a href="#rfc.section.4.8.3">"Atomic Fragments"</a></li>
<li>5.   <a href="#rfc.section.5">Implementation Requirements</a></li>
<li>5.1.   <a href="#rfc.section.5.1">Compliance with RFC6145 and RFC6052</a></li>
<li>5.2.   <a href="#rfc.section.5.2">Static Address Mapping Function</a></li>
<li>5.3.   <a href="#rfc.section.5.3">Support for Increasing the IPv6 Path MTU</a></li>
<li>5.4.   <a href="#rfc.section.5.4">Support for Disabling "Atomic Fragments"</a></li>
<li>5.5.   <a href="#rfc.section.5.5">Feature for Handling IPv4 Path MTUs Lower than 1260</a></li>
<li>5.6.   <a href="#rfc.section.5.6">Feature for Setting the IPv6 Flow Label</a></li>
<li>5.7.   <a href="#rfc.section.5.7">Loop Prevention Mechanism</a></li>
<li>6.   <a href="#rfc.section.6">Acknowledgements</a></li>
<li>7.   <a href="#rfc.section.7">Requirements Language</a></li>
<li>8.   <a href="#rfc.section.8">IANA Considerations</a></li>
<li>9.   <a href="#rfc.section.9">Security Considerations</a></li>
<li>9.1.   <a href="#rfc.section.9.1">Mistaking the Translation Prefix for a Trusted Network</a></li>
<li>9.2.   <a href="#rfc.section.9.2">Packets Looping Through the SIIT-DC Function</a></li>
<li>10.   <a href="#rfc.references">References</a></li>
<li>10.1.   <a href="#rfc.references.1">Normative References</a></li>
<li>10.2.   <a href="#rfc.references.2">Informative References</a></li>
<li>Appendix A.   <a href="#rfc.appendix.A">Complete SIIT-DC topology example</a></li>
<li>Appendix B.   <a href="#rfc.appendix.B">Comparison to Other Deployment Approaches</a></li>
<li>B.1.   <a href="#rfc.appendix.B.1">IPv4-only</a></li>
<li>B.2.   <a href="#rfc.appendix.B.2">IPv4-only + NAPT44</a></li>
<li>B.3.   <a href="#rfc.appendix.B.3">IPv4-only + NAT64</a></li>
<li>B.4.   <a href="#rfc.appendix.B.4">Dual Stack</a></li>
<li><a href="#rfc.authors">Author's Address</a></li>


  </ul>

  <h1 id="rfc.section.1"><a href="#rfc.section.1">1.</a> Introduction</h1>
<p id="rfc.section.1.p.1">SIIT-DC is an extension of <a href="#RFC6145">SIIT</a> <cite title="NONE">[RFC6145]</cite>, and provides a a network-centric stateless translation service that allows a data centre operator or Internet Content Provider (ICP) to run a data centre network, servers, and applications using exclusively IPv6, while at the same time ensuring that end users that have only IPv4 connectivity will be able to continue to access the services and applications.  </p>
<h1 id="rfc.section.1.1"><a href="#rfc.section.1.1">1.1.</a> Motivation and Goals</h1>
<p id="rfc.section.1.1.p.1">Historically, <a href="#RFC4213">dual stack</a> <cite title="NONE">[RFC4213]</cite> has been the recommended way to transition from an IPv4-only environment to one capable of serving IPv6 users. For data centre and Internet content providers, dual stack operation has a number of disadvantages compared to single stack operation. In particular, the increased complexity and operational overhead, and very low expected return of investment in the short to medium term, as there are practically no end-users who have only connectivity to the IPv6 Internet. Furthermore, the dual stack approach does not in any way help with the depletion of the IPv4 address space.  </p>
<p id="rfc.section.1.1.p.2">Therefore, a better approach is needed. The design goals are: </p>
<p/>

<ul>
  <li>Promote the deployment of native IPv6 services (cf. <a href="#RFC6540">[RFC6540]</a>).</li>
  <li>Provide IPv4 service availability for legacy users with no loss of performance or functionality.</li>
  <li>To ensure that that the legacy users' IPv4 addresses remain available to the servers and applications.</li>
  <li>To conserve and maximise the utilisation of IPv4 addresses.</li>
  <li>To avoid introducing more complexity than absolutely necessary, especially on the servers and applications.</li>
  <li>To be easy to scale and deploy in a fault-tolerant manner.</li>
</ul>

<p> </p>
<p id="rfc.section.1.1.p.4">The following subsections elaborates on how SIIT-DC meets these goals.  </p>
<h1 id="rfc.section.1.1.1"><a href="#rfc.section.1.1.1">1.1.1.</a> Single Stack IPv6 Operation</h1>
<p id="rfc.section.1.1.1.p.1">SIIT-DC allows an operator to build their applications on an IPv6-only foundation. IPv4 end-user connectivity becomes a service provided by the network, which systems administration and application development staff do not need to concern themselves with.  </p>
<p id="rfc.section.1.1.1.p.2">Obviously, this will promote universal IPv6 deployment for all of the provider's services and applications.  </p>
<p id="rfc.section.1.1.1.p.3">It is worth noting that SIIT-DC requires no special support or change from the underlying IPv6 infrastructure, it will work with any kind of IPv6 network. Traffic between IPv6-enabled end users and IPv6-enabled services will always be native, and SIIT-DC will not be involved in it at all.  </p>
<h1 id="rfc.section.1.1.2"><a href="#rfc.section.1.1.2">1.1.2.</a> Stateless Operation</h1>
<p id="rfc.section.1.1.2.p.1">Unlike other solutions that provide either dual stack availability to single-stack services (e.g., <a href="#RFC6146">Stateful NAT64</a> <cite title="NONE">[RFC6146]</cite> and Layer-4/7 proxies), or that provide conservation of IPv4 addresses (e.g., <a href="#RFC3022">NAPT44</a> <cite title="NONE">[RFC3022]</cite>), a SIIT-DC Gateway does not keep any state between each packet in a single connection or flow. In this sense it operates exactly like a normal IP router, and has similar scaling properties - the limiting factors are packets per second and bandwidth. The number of concurrent flows and flow initiation rates are irrelevant for performance.  </p>
<p id="rfc.section.1.1.2.p.2">This not only allows individual SIIT-DC Gateways to easily attain "line rate" performance, it also allows for per-packet load balancing between multiple SIIT-DC Gateways using <a href="#RFC2991">Equal-Cost Multipath Routing</a> <cite title="NONE">[RFC2991]</cite>. Asymmetric routing is also acceptable, which makes it easy to avoid sub-optimal traffic patterns; the prefixes involved may be anycasted from all the SIIT-DC Gateways in the provider's network, thus ensuring that the most optimal path through the network is used, even where the optimal path in one direction differs from the optimal path in the opposite direction.  </p>
<p id="rfc.section.1.1.2.p.3">Finally, stateless operation means that high availability is easily achieved. If an SIIT-DC Gateway should fail, its traffic can be re-routed onto another SIIT-DC Gateway using a standard IP routing protocol. This does not impact existing flows any more than what any other IP re-routing event would.  </p>
<h1 id="rfc.section.1.1.3"><a href="#rfc.section.1.1.3">1.1.3.</a> IPv4 Address Conservation</h1>
<p id="rfc.section.1.1.3.p.1">In most parts of the world, it is difficult or even impossible to obtain generously sized IPv4 allocations from the Regional Internet Registries. The resulting scarcity in turn impacts individual end users and operators, which might be forced to purchase IPv4 addresses from other operators in order to cover their needs. This process can be risky to business continuity, in the case no suitable block for sale can be located, and/or turn out to be prohibitively expensive. Even so, a data centre operator will find that providing IPv4 service is essential, as a large share of the Internet users still does not have IPv6 connectivity.  </p>
<p id="rfc.section.1.1.3.p.2">A key goal of SIIT-DC is to help reduce a data centre operator's IPv4 address requirement to the absolute minimum, by allowing the operator to remove them entirely from components that do not need to communicate with endpoints in the IPv4 Internet. One example would be servers that are operating in a supporting/backend role and only communicates with to other servers (database servers, file servers, and so on). Another example would be the network infrastructure itself (router-to-router links, loopback addresses, and so on).  Furthermore, as LAN prefix sizes must always be rounded up to the nearest power of two (or larger, if one reserves space for future growth), even more IPv4 addresses will often end up being wasted without even being used.  </p>
<p id="rfc.section.1.1.3.p.3">With SIIT-DC, the operator can remove these valuable IPv4 addresses from his backend servers and network infrastructure, and reassign them to the SIIT-DC service as IPv4 Service Addresses. There is no requirement that IPv4 Service Addresses are assigned in an aggregated manner, so there is nothing lost due to infrastructure overhead; every single IPv4 address assigned to SIIT-DC can be used an IPv4 Service Address.  </p>
<h1 id="rfc.section.1.1.4"><a href="#rfc.section.1.1.4">1.1.4.</a> No Loss of End User's Source Address</h1>
<p id="rfc.section.1.1.4.p.1">SIIT-DC will map the entire end-user's source address into an predefined IPv6 translation prefix. This allows the application server to identify the user by an IPv4 address, which is useful for performing tasks like Geo-Location, logging, abuse handling, and so forth.  </p>
<h1 id="rfc.section.1.1.5"><a href="#rfc.section.1.1.5">1.1.5.</a> No Forklift Upgrades Required</h1>
<p id="rfc.section.1.1.5.p.1">Except for the introduction of the SIIT-DC Gateways themselves, there is no change required in the network, servers, applications, or anywhere else to specifically support SIIT-DC, compared to a dual stack deployment. From the clients', the servers', the IPv6 data centre network's, and the IPv4 Internet's point of view, SIIT-DC is practically invisible. It will work with any standards-compliant IPv4 or IPv6 stack.  </p>
<h1 id="rfc.section.1.1.6"><a href="#rfc.section.1.1.6">1.1.6.</a> No Architectural Dependency on IPv4</h1>
<p id="rfc.section.1.1.6.p.1">SIIT-DC will allow an ICP or data centre operator to build infrastructure and applications entirely on IPv6. This means that when the day comes to discontinue support for IPv4, no change needs to be made to the overall architecture - it's only a matter of shutting off the SIIT-DC Gateways. Therefore, by deploying native IPv6 along with SIIT-DC, operators will avoid future migration or deployment projects relating to IPv6 roll-out and/or IPv4 sun-setting.  </p>
<h1 id="rfc.section.2"><a href="#rfc.section.2">2.</a> <a href="#terminology" id="terminology">Terminology</a></h1>
<p id="rfc.section.2.p.1">This document makes use of the following terms: </p>
<p/>

<dl>
  <dt>IPv4 Service Address</dt>
  <dd style="margin-left: 8">A public IPv4 address with which IPv4-only clients will communicate. This communication will be translated to IPv6 by the SIIT-DC Gateway.</dd>
  <dt>IPv4 Service Address Pool</dt>
  <dd style="margin-left: 8">One or more IPv4 prefixes routed to the SIIT-DC Gateway's IPv4 interface. IPv4 Service Addresses are allocated from this pool. Note that this does not necessarily have to be a "pool" per se, as it could also be one or more host routes (whose prefix length is equal to /32). The primary purpose of using a pool rather than host routes is to facilitate IPv4 route aggregation and ease provisioning of new IPv4 Service Addresses.</dd>
  <dt>IPv6 Service Address</dt>
  <dd style="margin-left: 8">A public IPv6 address assigned to a server or application in the IPv6 network. IPv6-only and dual stacked clients communicates with this address directly without invoking SIIT-DC.  IPv4-only clients also communicates with this address through the SIIT-DC Gateway and via an IPv4 Service Address.</dd>
  <dt>SIIT-DC Host Agent</dt>
  <dd style="margin-left: 8">A logical function very similar to an SIIT-DC Gateway that resides on a server and provides virtual IPv4 connectivity to applications, by reversing the translations done by the SIIT-DC Gateway. It is an optional component of the SIIT-DC architecture, that may be used to increase application support. See <a href="#I-D.anderson-v6ops-siit-dc-2xlat">[I-D.anderson-v6ops-siit-dc-2xlat]</a>.</dd>
  <dt>SIIT-DC Gateway</dt>
  <dd style="margin-left: 8">A device or a logical function that translates between IPv4 and IPv6 in accordance with <a href="#implementation_reqs">Section 5</a>.</dd>
  <dt>Static Address Mapping</dt>
  <dd style="margin-left: 8">A bi-directional mapping between an IPv4 Service Address and an IPv6 Service Address configured in the SIIT-DC Gateway. When translating between IPv4 and IPv6, the SIIT-DC Gateway changes the address fields in the translated packet's IP header according to any matching Static Address Mapping.</dd>
  <dt>Translation Prefix</dt>
  <dd style="margin-left: 8">An IPv6 prefix into which the entire IPv4 address space is mapped. This prefix is routed to the SIIT-DC Gateway's IPv6 interface. It is either an Network-Specific Prefix or a Well-Known Prefix as specified in <a href="#RFC6052">[RFC6052]</a>. When translating between IPv4 and IPv6, the SIIT-DC Gateway prepends or strips the Translation Prefix from the address fields in the translated packet's IP header, unless a Static Address Mapping exists for the IP address in question.</dd>
</dl>

<p> </p>
<h1 id="rfc.section.3"><a href="#rfc.section.3">3.</a> <a href="#overview" id="overview">Architectural Overview</a></h1>
<div id="rfc.figure.1"/>
<div id="fig_architecture"/>
<p id="rfc.section.3.p.1">This section describes the basic SIIT-DC architecture.  </p>

<p>SIIT-DC Architecture</p>
<pre>
  +-------------------+         +----------------+
  | IPv6-capable user |         | IPv4-only user |
  | ================= |         | ============== |
  |                   |         |                |
  +-&lt;2001:db8::ab:cd&gt;-+         +-&lt;203.0.113.50&gt;-+
      |                                  |
   (the IPv6 internet)         (the IPv4 Internet)
      |                                  |
      |        +------------------&lt;192.0.2.0/24&gt;-+
      |        |                                 |
      |        |         SIIT-DC Gateway         |
      |        |         ===============         |
      |        |                                 |
      |        |       Translation Prefix:       |
      |        |         2001:db8:46::/96        |
      |        |                                 |
      |        |     Static Address Mapping:     |
      |        | 192.0.2.1 &lt;=&gt; 2001:db8:12:34::1 |
      |        |                                 |
      |        +--------------&lt;2001:db8:46::/96&gt;-+
      |                               |
     (the IPv6-only data centre network)
      |                               |
      | ------------------------------/
      |/
      |
+--&lt;2001:db8:12:34::1&gt;------------------------------+
|     |                                             |
|     |          IPv6-only server                   |
|     |          ================                   |
|     |                                             |
| +-[2001:db8:12:34::1]---------------------------+ |
| |      AF_INET6                                 | |
| |                                               | |
| |             IPv6-only application             | |
| |                                               | |
| +-----------------------------------------------+ |
+---------------------------------------------------+
        </pre>
<p class="figure">Figure 1</p>
<p id="rfc.section.3.p.2">In this example, 192.0.2.0/24 is allocated as an IPv4 Service Address Pool. Individual IPv4 Service Addresses are assigned from this pool.  The provider must route this prefix to the SIIT-DC Gateway's IPv4 interface. Note that there are no restrictions on how many IPv4 Service Address Pools are used or their prefix length, as long as they are all routed to the SIIT-DC Gateway's IPv4 interface.  </p>
<p id="rfc.section.3.p.3">The Static Address Mapping list is used when translating an IPv4 Service Address (here 192.0.2.1) to its corresponding IPv6 Service Address (here 2001:db8:12:34::1) and vice versa. When the SIIT-DC Gateway translates an IPv4 packet to IPv6, any IPv4 Service Address found in the original IPv4 header will be replaced with the corresponding IPv6 Service Address in the resulting IPv6 header, and vice versa when translating an IPv6 packet to IPv4.  </p>
<p id="rfc.section.3.p.4">2001:db8:46::/96 is the Translation Prefix into which the entire IPv4 address space is mapped. It is used for translation of the end user's IPv4 address to IPv6 and vice versa according to the algorithm defined in <a href="#RFC6052">Section 2.2 of RFC6052</a> <cite title="NONE">[RFC6052]</cite>. This algorithmic mapping has a lower precedence than the configured Static Address Mappings.  </p>
<p id="rfc.section.3.p.5">The SIIT-DC Gateway itself can be either a separate device or a logical function in another multi-purpose device, for example an IP router. Any number of SIIT-DC Gateways may exist simultaneously in an operators infrastructure, as long as they all have the same translation prefix and list of Static Mappings configured.  </p>
<h1 id="rfc.section.3.1"><a href="#rfc.section.3.1">3.1.</a> DNS Configuration</h1>
<p id="rfc.section.3.1.p.1">The IPv6 Service Address of should be registered in DNS using an AAAA record, while its corresponding IPv4 Service Address should be registered using an A record. This results in the following DNS records: </p>
<div id="rfc.figure.2"/>
<div id="fig_dnsconfig"/>
<p/>

<p>DNS Configuration for a SIIT-DC enabled service</p>
<pre>
app.domain.tld.    IN AAAA  2001:db8:12:34::1
app.domain.tld.    IN A     192.0.2.1
          </pre>
<p class="figure">Figure 2</p>
<h1 id="rfc.section.3.2"><a href="#rfc.section.3.2">3.2.</a> Packet Flow</h1>
<p id="rfc.section.3.2.p.1">In this example, "IPv4-only user" initiates a request to the application running on the IPv6-only server. He starts by looking up the IN A record of "app.domain.tld" in DNS, and attempts to connect to this address on the service by transmitting the following IPv4 packet destined for the IPv4 Service Address: </p>
<div id="rfc.figure.3"/>
<div id="fig_xlat_s1"/>
<p/>

<p>Stage 1: Client -&gt; Server, IPv4</p>
<pre>
+------------------------------------------------+
| IP Version:           4                        |
| Source Address:       203.0.113.50             |
| Destination Address:  192.0.2.1                |
| Protocol:             TCP                      |
|------------------------------------------------|
| TCP SYN [...]                                  |
+------------------------------------------------+
          </pre>
<p class="figure">Figure 3</p>
<p id="rfc.section.3.2.p.3">This packet is then routed over the Internet to the (nearest) SIIT-DC Gateway, which translates it into the following IPv6 packet and forward it into the IPv6 network: </p>
<div id="rfc.figure.4"/>
<div id="fig_xlat_s2"/>
<p/>

<p>Stage 2: Client -&gt; Server request, IPv4</p>
<pre>
+-------------------------------------------------+
| IP Version:           6                         |
| Source Address:       2001:db8:46::203.0.113.50 |
| Destination Address:  2001:db8:12:34::1         |
| Next Header:          TCP                       |
|-------------------------------------------------|
| TCP SYN [...]                                   |
+-------------------------------------------------+
          </pre>
<p class="figure">Figure 4</p>
<p id="rfc.section.3.2.p.5">The destination address field was translated to the IPv6 Service Address according to the configured Static Address Mapping, while the source address was field translated according to the <a href="#RFC6052">[RFC6052]</a> mapping using the Translation Prefix (because it did not match any Static Address Mapping). The rest of the IP header was translated according to <a href="#RFC6145">[RFC6145]</a>. The Layer 4 payload is copied verbatim, with the exception of the TCP checksum being recalculated.  </p>
<p id="rfc.section.3.2.p.6">Note that the IPv6 address 2001:db8:46::203.0.113.50 may also be expressed as 2001:db8:46::cb00:7132, cf. <a href="#RFC2373">Section 2.2 of RFC2373</a> <cite title="NONE">[RFC2373]</cite>.  </p>
<p id="rfc.section.3.2.p.7">Next, the application receives receives this IPv6 packet and responds to it like it would with any other IPv6 packet: </p>
<div id="rfc.figure.5"/>
<div id="fig_xlat_s3"/>
<p/>

<p>Stage 3: Server -&gt; Client response, IPv6</p>
<pre>
+-------------------------------------------------+
| IP Version:           6                         |
| Source Address:       2001:db8:12:34::1         |
| Destination Address:  2001:db8:46::203.0.113.50 |
| Next Header:          TCP                       |
|-------------------------------------------------|
| TCP SYN+ACK [...]                               |
+-------------------------------------------------+
          </pre>
<p class="figure">Figure 5</p>
<p id="rfc.section.3.2.p.9">The response packet is routed to the (nearest) SIIT-DC Gateway's IPv6 interface, which will translate it back to IPv4 as follows: </p>
<div id="rfc.figure.6"/>
<div id="fig_xlat_s4"/>
<p/>

<p>Stage 4: Server -&gt; Client response, IPv4</p>
<pre>
+------------------------------------------------+
| IP Version:           4                        |
| Source Address:       192.0.2.2                |
| Destination Address:  203.0.113.50             |
| Protocol:             TCP                      |
|------------------------------------------------|
| TCP SYN+ACK [...]                              |
+------------------------------------------------+
          </pre>
<p class="figure">Figure 6</p>
<p id="rfc.section.3.2.p.11">This time, the source address matched the Static Address Mapping and was translated accordingly, while the destination address did not, and was therefore translated according to <a href="#RFC6052">[RFC6052]</a> by having the Translation Prefix stripped. The rest of the packet was translated according to <a href="#RFC6145">[RFC6145]</a>.  </p>
<p id="rfc.section.3.2.p.12">The resulting IPv4 packet is transmitted back to the end user over the IPv4 Internet. Subsequent packets in the flow will follow the exact same translation pattern. They may or may not cross the same translators as earlier packets in the same flow.  </p>
<p id="rfc.section.3.2.p.13">The end user's IPv4 stack has no idea that it is communicating with an IPv6 server, nor does the server's IPv6 stack have any idea that is is communicating with an IPv4 client. To them, it's just plain IPv4 or IPv6, respectively. However, the applications running on the server may optionally be updated to recognise and strip the Translation Prefix, so that the end user's IPv4 address may be used for logging, Geo-Location, abuse handling, and so forth.  </p>
<h1 id="rfc.section.4"><a href="#rfc.section.4">4.</a> Deployment Guidelines</h1>
<p id="rfc.section.4.p.1">In this section, we list recommendations and guidelines for operators who would like to deploy a SIIT-DC service in their data centre network.  </p>
<h1 id="rfc.section.4.1"><a href="#rfc.section.4.1">4.1.</a> Application Support for NAT</h1>
<p id="rfc.section.4.1.p.1">Not all application protocols are able to operate in a network environment where rewriting of IP addresses occur. An operator should therefore carefully evaluate the applications he would like to make available for IPv4 users through SIIT-DC, to ensure they do not fall in this category. In general, if an application layer protocol works correctly through standard NAT44 (see <a href="#RFC3235">[RFC3235]</a>), it will most likely work correctly through SIIT-DC as well.  </p>
<p id="rfc.section.4.1.p.2">Higher-level protocols that embed IP addresses as part of their payload are especially problematic, as noted in <a href="#RFC2663">[RFC2663]</a>, <a href="#RFC2993">[RFC2993]</a>, and <a href="#RFC3022">[RFC3022]</a>. Such protocols will most likely not work through any form of address translation, including SIIT-DC. One well-known example of such a protocol is <a href="#RFC0959">FTP</a> <cite title="NONE">[RFC0959]</cite>.  </p>
<p id="rfc.section.4.1.p.3">The SIIT-DC architecture may be extended with a Host Agent that reverses the translation performed by the SIIT-DC Gateway before passing the packets to the application software. This allows the problematic application protocols described above to work correctly in an SIIT-DC environment as well. See <a href="#I-D.anderson-v6ops-siit-dc-2xlat">[I-D.anderson-v6ops-siit-dc-2xlat]</a> for a description of this extension.  </p>
<h1 id="rfc.section.4.2"><a href="#rfc.section.4.2">4.2.</a> Application Support for IPv6</h1>
<p id="rfc.section.4.2.p.1">SIIT-DC requires that the application software supports IPv6 networking, and that it has no dependency on IPv4 networking. If this is not the case, the approach described in <a href="#I-D.anderson-v6ops-siit-dc-2xlat">[I-D.anderson-v6ops-siit-dc-2xlat]</a> may be used, as it provides the application with seemingly native IPv4 connectivity. This allows IPv4-only applications to work correctly in an otherwise IPv6-only environment.  </p>
<h1 id="rfc.section.4.3"><a href="#rfc.section.4.3">4.3.</a> Application Communication Pattern</h1>
<p id="rfc.section.4.3.p.1">SIIT-DC is ideally suited for applications where IPv4-only nodes on the Internet initiate traffic towards the IPv6-only services, which in turn are only passively listening for inbound traffic and responding as necessary. One well-known example of such a protocol is  <a href="#RFC2616">HTTP</a> <cite title="NONE">[RFC2616]</cite>. This is due to the fact that in this case, an IPv4 user looks exactly like an ordinary IPv6 user from the host and application's point of view, and requires no special treatment.  </p>
<p id="rfc.section.4.3.p.2">It is possible to combine SIIT-DC with <a href="#RFC6147">DNS64</a> <cite title="NONE">[RFC6147]</cite> in order to allow an IPv6-only application to initiate communication with IPv4-only nodes through an SIIT-DC Gateway. However, in this case, care must be taken so that all outgoing communication is sourced from the IPv6 Service Address that has a Static Mapping configured on the SIIT-DC Gateway. If another unmapped address is used, the SIIT-DC Gateway will discard the packet.  </p>
<p id="rfc.section.4.3.p.3">An alternative approach to the above would be to make use of an SIIT-DC Host Agent as described in <a href="#I-D.anderson-v6ops-siit-dc-2xlat">[I-D.anderson-v6ops-siit-dc-2xlat]</a>. This provides the application with seemingly native IPv4 connectivity, which it may use for both inbound and outbound communication without requiring the application to select a specific source address for its outbound communications.  </p>
<h1 id="rfc.section.4.4"><a href="#rfc.section.4.4">4.4.</a> Choice of Translation Prefix</h1>
<p id="rfc.section.4.4.p.1">Either a Network-Specific Prefix (NSP) from the provider's own IPv6 address space or the IANA-allocated Well-Known Prefix 64:ff9b::/96 (WKP) may be used. From a technical point of view, both should work equally well, however as only a single WKP exists, if a provider would like to deploy more than one instance of SIIT-DC in his network, or <a href="#RFC6146">Stateful NAT64</a> <cite title="NONE">[RFC6146]</cite>, an NSP must be used anyway for all but one of those deployments.  </p>
<p id="rfc.section.4.4.p.2">Furthermore, the WKP cannot be used in inter-domain routing. By using an NSP, a provider will have the possibility to provide SIIT-DC service to other operators across Autonomous System borders.  </p>
<p id="rfc.section.4.4.p.3">For these reasons, this document recommends that an NSP is used.  Section 3.3 of <a href="#RFC6052">[RFC6052]</a> discusses the choice of translation prefix in more detail.  </p>
<p id="rfc.section.4.4.p.4">The Translation Prefix may use any of the lengths described in <a href="#RFC6052">Section 2.2 of RFC6052</a> <cite title="NONE">[RFC6052]</cite>, but /96 has two distinct advantages over the others. First, converting it to IPv4 can be done in a single operation by simply stripping off the first 96 bits; second, it allows for IPv4 addresses to be embedded directly into the text representation of an IPv6 address using the familiar dotted quad notation, e.g., "2001:db8::198.51.100.10" (cf. <a href="#RFC6052">Section 2.4 of RFC6052</a> <cite title="NONE">[RFC6052]</cite>)), instead of being converted to hexadecimal notation. This makes it easier to write IPv6 ACLs and similar that match translated endpoints in the IPv4 Internet.  Use of a /96 prefix length is therefore recommended.  </p>
<h1 id="rfc.section.4.5"><a href="#rfc.section.4.5">4.5.</a> Routing Considerations</h1>
<p id="rfc.section.4.5.p.1">The prefixes that constitute the IPv4 Service Address Pool and the IPv6 Translation Prefix may be routed to the SIIT-DC Gateway(s) as any other IPv4 or IPv6 route in the provider's network.  </p>
<p id="rfc.section.4.5.p.2">If more than one SIIT-DC Gateway is being deployed, it is recommended that a dynamic routing protocol (such as BGP, IS-IS, or OSPF) is being used to advertise the routes within the provider's network. This will ensure that the traffic that is to be translated will reach the closest SIIT-DC Gateway, reducing or eliminating sub-optimal traffic patterns, as well as provide high availability - if one SIIT-DC Gateway fails, the dynamic routing protocol will automatically redirect the traffic to the next-best translator.  </p>
<h1 id="rfc.section.4.6"><a href="#rfc.section.4.6">4.6.</a> Location of the SIIT-DC Gateways</h1>
<p id="rfc.section.4.6.p.1">The goal of SIIT-DC is to facilitate a true IPv6-only application and network architecture, with the sole exception being the IPv4 interfaces of the SIIT-DC Gateways and the network infrastructure required to connect them to the IPv4 Internet. Therefore, the SIIT-DC Gateways should be located somewhere beween the IPv4 Internet and the application delivery stack. This should be understood to include all servers, load balancers, firewalls, intrusion detection systems, and similar devices that are processing traffic to a greater extent than merely forwarding it.  </p>
<p id="rfc.section.4.6.p.2">It is optimal to place the SIIT-DC Gateways as close as possible to the direct path between the servers and the end users. If the closest translator is located a long way from the optimal path, all packets in both directions must make a detour. This would increase the RTT between the server and the end user by by two times the extra latency incurred by the detour, as well as cause unnecessary load on the network links on the detour path.  </p>
<p id="rfc.section.4.6.p.3">Where possible, it is beneficial to implement the SIIT-DC Gateways as a logical function within the routers would have handled the traffic anyway, had the topology been dual stacked. This way, the translation service would not need to be assigned separate networks ports (which might become saturated and impact the service quality), nor would it require extra rack space and energy. Some particularly good choices of the location could be within a data centre's access routers, or inside the provider's border routers. When every single application in the data centre or the provider's network eventually runs on single-stack IPv6, there would no need to run IPv4 on the inside of the SIIT-DC Gateway. This reduces complexity, and allows the operator to reclaim IPv4 addresses from the network infrastructure that may instead be used for translated services.  </p>
<p id="rfc.section.4.6.p.4">Finally, another possibility is that the data centre operator outsources the SIIT-DC service to another entity, for example his upstream ISP. Doing so allows the data centre operator to build a true IPv6-only infrastructure. However, in this case, care must be taken to ensure that the path between the data centre and the SIIT-DC operator has a stable and known MTU, and that the SIIT-DC Gateways are not too far away from the data centre (otherwise, translated traffic could incur a latency penalty).  </p>
<h1 id="rfc.section.4.7"><a href="#rfc.section.4.7">4.7.</a> Migration from Dual Stack</h1>
<p id="rfc.section.4.7.p.1">While this document discusses the use of IPv6-only servers and applications, there is no technical requirement that the servers are IPv4 free. SIIT-DC works equally well for dual stacked servers, which makes migration easy - after setting up the translation function, the DNS A record for the service is updated to point to the IPv4 address that will be translated to IPv6, the previously used IPv4 service address may continue to be assigned to the server. This makes roll-back to dual stack easy, as it is only a matter of changing the DNS record back to what it was before.  </p>
<p id="rfc.section.4.7.p.2">For high-volume services migrating to SIIT-DC from dual stack, DNS Round Robin may be used to gradually migrate the service's IPv4 traffic from its native IPv4 address(es) to the translated IPv4 Service Address(s).  </p>
<h1 id="rfc.section.4.8"><a href="#rfc.section.4.8">4.8.</a> Packet Size and Fragmentation Considerations</h1>
<p id="rfc.section.4.8.p.1">There are two key differences between IPv4 and IPv6 relating to packet sizes that one should consider when deploying SIIT-DC. They result in a few problematic corner cases, which can be dealt with in a few different ways.  </p>
<p id="rfc.section.4.8.p.2">The operator may find that relying on fragmentation in the IPv6 domain is undesired or even operationally impossible <a href="#I-D.taylor-v6ops-fragdrop">[I-D.taylor-v6ops-fragdrop]</a>.  For this reason, the recommendations in this section seeks to minimise the use of IPv6 fragmentation.  </p>
<p id="rfc.section.4.8.p.3">Unless otherwise stated, this section assumes that the MTU in both the IPv4 and IPv6 domains is 1500 bytes.  </p>
<h1 id="rfc.section.4.8.1"><a href="#rfc.section.4.8.1">4.8.1.</a> IP Header Size Difference</h1>
<p id="rfc.section.4.8.1.p.1">The IPv6 header is up to 20 bytes larger than the IPv4 header. This means that a full-size 1500 bytes large IPv4 packet cannot be translated to IPv6 without being fragmented, otherwise it would likely have resulted in a 1520 bytes large IPv6 packet.  </p>
<p id="rfc.section.4.8.1.p.2">If the transport protocol used is TCP, this is generally not a problem, as the IPv6 server will advertise a TCP MSS of 1440 bytes.  This causes the client to never send larger packets than what can be translated to a single full-size IPv6 packet, eliminating any need for fragmentation.  </p>
<p id="rfc.section.4.8.1.p.3">For other transport protocols, full-size IPv4 packets with the DF flag cleared will need to be fragmented by the SIIT-DC Gateway. The only way to avoid this is to increase the Path MTU between the SIIT-DC Gateway and the servers to 1520 bytes. Note that the servers' MTU SHOULD NOT be increased accordingly, as that would cause them to undergo Path MTU Discovery for most native IPv6 destinations. However, the servers would need to be able to accept and process incoming packets larger than their own MTU. If the server's IPv6 implementation allows the MTU to be set differently for specific destinations, it could be increased to 1520 for destinations within the Translation Prefix specifically.  </p>
<h1 id="rfc.section.4.8.2"><a href="#rfc.section.4.8.2">4.8.2.</a> Minimum Path MTU Difference</h1>
<p id="rfc.section.4.8.2.p.1">The minimum allowed link MTU in IPv6 is 1280 bytes. In IPv4, the corresponding value is 68 bytes. This means that an 1280 byte large IPv6 packet sent to an IPv4 client may need to be fragmented by a router in the IPv4 network, if the path to the IPv4 client involves a link with a MTU lower than 1260 bytes.  </p>
<p id="rfc.section.4.8.2.p.2">By default, an SIIT-DC Gateway will set the DF flag when translating from IPv6 to IPv4, resulting in a situation where the IPv6 server may receive an ICMPv6 Packet Too Big error where the indicated MTU value is less than the IPv6 minimum of 1280. In this situation, the IPv6 server has two choices on how to proceed, according to the last paragraph of <a href="#RFC2460">Section 5 of RFC2460</a> <cite title="NONE">[RFC2460]</cite>: </p>
<p/>

<ul>
  <li>It may reduce its Path MTU value to the value indicated in the Packet Too Big. This causes no problems for the SIIT-DC function.</li>
  <li>It may reduce its Path MTU value to exactly 1280, and also include a Fragmentation header in each subsequent packet sent to that destination. The Fragmentation header signals to the the SIIT-DC Gateway that the DF flag should be cleared in the resulting IPv4 packet, and it also provides the Identification value.</li>
</ul>

<p> </p>
<p id="rfc.section.4.8.2.p.4">If the use of the IPv6 Fragmentation header is problematic, and the operator has IPv6 servers that implement the second option above, the operator should enable a feature on the SIIT-DC Gateways which ensures that the resulting MTU field is always set to 1280 or higher when translating ICMPv4 Need to Fragment into ICMPv6 Packet Too Big, and that when translating IPv6 packets smaller or equal to 1280 bytes the resulting IPv4 packets will have the DF flag cleared and an Identification value generated, cf. <a href="#feat_smallv4pmtu">Section 5.5</a>.  </p>
<h1 id="rfc.section.4.8.3"><a href="#rfc.section.4.8.3">4.8.3.</a> "Atomic Fragments"</h1>
<p id="rfc.section.4.8.3.p.1">By default, an SIIT-DC Gateway will include a Fragmentation header in the resulting IPv6 packet when translating from an IPv4 packet with the DF flag cleared, cf. <a href="#RFC6145">Section 4 of RFC6145</a> <cite title="NONE">[RFC6145]</cite>.  </p>
<p id="rfc.section.4.8.3.p.2">This happens even though the resulting IPv6 packet isn't actually fragmented into several pieces, resulting in an "Atomic Fragment" <a href="#RFC6946">[RFC6946]</a>. This is generally not useful in a data centre environment, and it is therefore recommended that this behaviour is disabled in the SIIT-DC Gateway(s). See <a href="#feat_noatomicfrags">Section 5.4</a>.  </p>
<h1 id="rfc.section.5"><a href="#rfc.section.5">5.</a> <a href="#implementation_reqs" id="implementation_reqs">Implementation Requirements</a></h1>
<p id="rfc.section.5.p.1">This normative section specifies the SIIT-DC protocol that is implemented by an SIIT-DC Gateway. Because SIIT-DC builds on and closely resembles <a href="#RFC6145">SIIT</a> <cite title="NONE">[RFC6145]</cite>, this section should be read as a set of additions and changes that are applied to an implementation already compliant to <a href="#RFC6145">SIIT</a> <cite title="NONE">[RFC6145]</cite>.  Each of the following subsections discuss how the requirement relates to with any corresponding requirements in <a href="#RFC6145">SIIT</a> <cite title="NONE">[RFC6145]</cite>.  </p>
<h1 id="rfc.section.5.1"><a href="#rfc.section.5.1">5.1.</a> Compliance with RFC6145 and RFC6052</h1>
<p id="rfc.section.5.1.p.1">Unless otherwise stated in the following sections, an SIIT-DC implementation MUST comply fully with <a href="#RFC6145">[RFC6145]</a>. It must also implement the algorithmic address mapping defined in <a href="#RFC6052">[RFC6052]</a>.  </p>
<h1 id="rfc.section.5.2"><a href="#rfc.section.5.2">5.2.</a> Static Address Mapping Function</h1>
<p id="rfc.section.5.2.p.1">The implementation MUST allow the operator to configure an arbitrary number of Static Address Mappings which override the default <a href="#RFC6052">[RFC6052]</a> algorithm. It SHOULD be possible to specify a single bi-directional mapping that will be used in both the IPv4=&gt;IPv6 and IPv6=&gt;IPv4 directions, but it MAY additionally (or alternatively) support unidirectional mappings.  </p>
<p id="rfc.section.5.2.p.2">An example of such a bidirectional Static Address Mapping would be: </p>
<p/>

<ul>
  <li>192.0.2.1 &lt;=&gt; 2001:db8:12:34::1</li>
</ul>

<p> </p>
<p id="rfc.section.5.2.p.4">To accomplish the same using unidirectional mappings, the following two mappings must instead be configured: </p>
<p/>

<ul>
  <li>192.0.2.1 =&gt; 2001:db8:12:34::1</li>
  <li>2001:db8:12:34::1 =&gt; 192.0.2.1</li>
</ul>

<p> </p>
<p id="rfc.section.5.2.p.6">In both cases, if the SIIT-DC Gateway receives an IPv6 packet that has the value 2001:db8:12:34::1 in either the source or destination field of the IPv6 header, it MUST rewrite this field to 192 0.2.1 when translating to IPv4. Similarly, if the SIIT-DC Gateway receives an IPv4 packet that has the value 192.0.2.1 as the either the source or destination field of the IPv4 header, it MUST rewrite this field to 2001:db8:12:34::1 when translating to IPv6. For all IPv4 or IPv6 source or destination field values for which there are no Static Address Mapping, <a href="#RFC6052">[RFC6052]</a> compliant mapping MUST be used instead.  </p>
<p id="rfc.section.5.2.p.7">Relation to <a href="#RFC6145">[RFC6145]</a>: The Static Address Mapping is a novel feature feature that is not discussed in <a href="#RFC6145">[RFC6145]</a>. It conflicts with <a href="#RFC6145">[RFC6145]</a>'s requirement that all addresses must be translated according to the <a href="#RFC6052">[RFC6052]</a> algorithm.  </p>
<h1 id="rfc.section.5.3"><a href="#rfc.section.5.3">5.3.</a> <a href="#feat_incrv6pmtu" id="feat_incrv6pmtu">Support for Increasing the IPv6 Path MTU</a></h1>
<p id="rfc.section.5.3.p.1">The SIIT-DC Gateway MUST provide a configuration function for the network administrator to adjust the threshold of the minimum IPv6 MTU to a value that reflects the real value of the minimum IPv6 MTU in the network (greater than 1280 bytes). This will help reduce the chance of including the Fragment Header in the packets.  </p>
<p id="rfc.section.5.3.p.2">Relation to <a href="#RFC6145">[RFC6145]</a>: This strengthens the corresponding "MAY" requirement located in <a href="#RFC6145">Section 4 of RFC6145</a> <cite title="NONE">[RFC6145]</cite> to a "MUST".  </p>
<h1 id="rfc.section.5.4"><a href="#rfc.section.5.4">5.4.</a> <a href="#feat_noatomicfrags" id="feat_noatomicfrags">Support for Disabling "Atomic Fragments"</a></h1>
<p id="rfc.section.5.4.p.1">When the IPv4 sender does not set the DF bit, the SIIT-DC Gateway SHOULD NOT include an IPv6 Fragment Header in resulting non-fragmented IPv6 packets. If does, the SIIT-DC Gateway MUST provide a configuration function that allows the SIIT-DC Gateway not to include the Fragment Header for the non-fragmented IPv6 packets.  </p>
<p id="rfc.section.5.4.p.2">Relation to <a href="#RFC6145">[RFC6145]</a>: This is an update of the corresponding requirement in <a href="#RFC6145">Section 4 of RFC6145</a> <cite title="NONE">[RFC6145]</cite>. It inverts the recommended default behaviour to not generate IPv6 Atomic Fragments, and strengthens the "MAY" requirement for making it possible to disable this behaviour to a "MUST".  </p>
<p id="rfc.section.5.4.p.3">For the definition of an "Atomic Fragment", see <a href="#RFC6946">[RFC6946]</a>.  </p>
<h1 id="rfc.section.5.5"><a href="#rfc.section.5.5">5.5.</a> <a href="#feat_smallv4pmtu" id="feat_smallv4pmtu">Feature for Handling IPv4 Path MTUs Lower than 1260</a></h1>
<p id="rfc.section.5.5.p.1">In order to prevent unnecessary fragments, the implementation SHOULD support a feature which, if enabled by the operator, changes the SIIT-DC Gateway's default behaviour accordingly: </p>
<p/>

<ul>
  <li>When translating an ICMPv4 Need To Fragment packet indicating a Path MTU smaller than or equal to 1260, the MTU field in the resulting ICMPv6 Packet Too Big is set to 1280.</li>
  <li>When translating an IPv6 packet that is smaller or equal to 1280 bytes, the DF flag in the resulting IPv4 packet is cleared, and an IPv4 Identification value is generated. The SIIT-DC Gateway MUST NOT create or maintain any state as a result of this.</li>
</ul>

<p> </p>
<p id="rfc.section.5.5.p.3">Relation to <a href="#RFC6145">[RFC6145]</a>: This is a modified version of the second approach described in <a href="#RFC6145">Section 6 of RFC6145</a> <cite title="NONE">[RFC6145]</cite>. The modifications are: </p>
<p/>

<ol>
  <li>In the IPv4-to-IPv6 direction, the algorithm only used for ICMPv4 Need To Fragment packets that indicate an MTU value smaller or equal to 1260. The corresponding value used by <a href="#RFC6145">[RFC6145]</a> is smaller than 1280.</li>
  <li>In the IPv6-to-IPv4 direction, an SIIT-DC Gateway MUST NOT generate and maintain any state due to generating IPv4 Identification values.  <a href="#RFC6145">[RFC6145]</a> RECOMMENDS that this is done.</li>
</ol>

<p> </p>
<p id="rfc.section.5.5.p.5">Also see <a href="#I-D.gont-6man-deprecate-atomfrag-generation">[I-D.gont-6man-deprecate-atomfrag-generation]</a>, which seeks to formally update <a href="#RFC6145">[RFC6145]</a> with the approach described in this section.  </p>
<h1 id="rfc.section.5.6"><a href="#rfc.section.5.6">5.6.</a> Feature for Setting the IPv6 Flow Label</h1>
<p id="rfc.section.5.6.p.1">When an SIIT-DC Gateway is translating an IPv4 packet into IPv6, it might be considered to be an "IPv6 source node" as described by <a href="#RFC6437">[RFC6437]</a>, due to the fact that the is no IPv4 header field that corresponsds to the IPv6 Flow Label. To facilitate stateless IPv6 load balancers <a href="#RFC7098">[RFC7098]</a>, an SIIT-DC Gateway SHOULD support a feature that makes the SIIT-DC Gateway set the Flow Label field of the IPv6 header in accordance with <a href="#RFC6437">Section 3 of RFC6437</a> <cite title="NONE">[RFC6437]</cite> when translating from IPv4.  </p>
<p id="rfc.section.5.6.p.2">Relation to <a href="#RFC6145">[RFC6145]</a>: As <a href="#RFC6145">[RFC6145]</a> predates <a href="#RFC6437">[RFC6437]</a>, this use of the Flow Label is not discussed in <a href="#RFC6145">[RFC6145]</a>. Instead, <a href="#RFC6145">Section 4.1 of RFC 6145</a> <cite title="NONE">[RFC6145]</cite> requires that the Flow Label is set to 0. Therefore, this feature (if enabled) would arguably conflict with <a href="#RFC6145">[RFC6145]</a>.  </p>
<h1 id="rfc.section.5.7"><a href="#rfc.section.5.7">5.7.</a> Loop Prevention Mechanism</h1>
<p id="rfc.section.5.7.p.1">As noted in <a href="#sec_loops">Section 9.2</a>, there is a potential for packets looping through the SIIT-DC function if it receives an IPv4 packet for which there is no Static Address Mapping. It is therefore RECOMMENDED that the implementation has a mechanism that automatically prevents this behaviour. One way this could be accomplished would be to discard any IPv4 packets that would be translated into an IPv6 packet that would be routed straight back into the SIIT-DC function.  </p>
<p id="rfc.section.5.7.p.2">If such a mechanism isn't provided, the implementation MUST provide a way to manually filter or null-route the destination addresses that would otherwise cause loops.  </p>
<p id="rfc.section.5.7.p.3">Relation to <a href="#RFC6145">[RFC6145]</a>: This security consideration applies only when an SIIT-DC Gateway translates a packet in "pure" <a href="#RFC6145">SIIT</a> <cite title="NONE">[RFC6145]</cite> mode (i.e., both address fields are translated according to <a href="#RFC6052">[RFC6052]</a>). This consideration is in other words not specific to SIIT-DC, it is inherited from <a href="#RFC6145">[RFC6145]</a>. In spite of this, <a href="#RFC6145">[RFC6145]</a> does not describe this consideration or any methods of prevention. The requirements in this section is therefore novel to SIIT-DC, even though they apply equally to <a href="#RFC6145">[RFC6145]</a>.  </p>
<h1 id="rfc.section.6"><a href="#rfc.section.6">6.</a> <a href="#Acknowledgements" id="Acknowledgements">Acknowledgements</a></h1>
<p id="rfc.section.6.p.1">The author would like to thank the following individuals for their contributions, suggestions, corrections, and criticisms: Fred Baker, Cameron Byrne, Brian E Carpenter, Ross Chandler, Dagfinn Ilmari Mannsaaker, Lars Olafsen, Stig Sandbeck Mathisen, Knut A. Syed.  </p>
<h1 id="rfc.section.7"><a href="#rfc.section.7">7.</a> Requirements Language</h1>
<p id="rfc.section.7.p.1">The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT", "SHOULD", "SHOULD NOT", "RECOMMENDED", "MAY", and "OPTIONAL" in this document are to be interpreted as described in <a href="#RFC2119">[RFC2119]</a>.  </p>
<h1 id="rfc.section.8"><a href="#rfc.section.8">8.</a> <a href="#IANA" id="IANA">IANA Considerations</a></h1>
<p id="rfc.section.8.p.1">This draft makes no request of the IANA. The RFC Editor may remove this section prior to publication.  </p>
<h1 id="rfc.section.9"><a href="#rfc.section.9">9.</a> <a href="#Security" id="Security">Security Considerations</a></h1>
<h1 id="rfc.section.9.1"><a href="#rfc.section.9.1">9.1.</a> Mistaking the Translation Prefix for a Trusted Network</h1>
<p id="rfc.section.9.1.p.1">If a Network-Specific Prefix from the provider's own address space is chosen for the translation prefix, as is recommended, care must be taken if the translation service is used in front of services that have application-level ACLs that distinguish between the operator's own networks and the Internet at large, as the translated IPv4 end users on the Internet will appear to come from within the provider's own IPv6 address space. It is therefore important that the translation prefix is treated the same as the Internet at large, rather than as a trusted network.  </p>
<h1 id="rfc.section.9.2"><a href="#rfc.section.9.2">9.2.</a> <a href="#sec_loops" id="sec_loops">Packets Looping Through the SIIT-DC Function</a></h1>
<p id="rfc.section.9.2.p.1">If the SIIT-DC Gateway receives an IPv4 packet destined to an address for which there is no Static Address Mapping, its destination address will be rewritten according to <a href="#RFC6052">[RFC6052]</a>, making the resulting IPv6 packet have a destination address within the translation prefix, which is likely routed to back to the SIIT-DC function. This will cause the packet to loop until its Time To Live / Hop Limit reaches zero, potentially creating a Denial Of Service vulnerability.  </p>
<p id="rfc.section.9.2.p.2">To avoid this, it should be ensured that packets sent to IPv4 destinations addresses for which there are no Static Address Mappings, or whose resulting IPv6 address does not have a more-specific route to the IPv6 network, are immediately discarded.  </p>
<h1 id="rfc.references"><a href="#rfc.references">10.</a> References</h1>
<h1 id="rfc.references.1"><a href="#rfc.references.1">10.1.</a> Normative References</h1>
<table>
  <tbody>
    <tr>
      <td class="reference">
        <b id="RFC2119">[RFC2119]</b>
      </td>
      <td class="top"><a href="mailto:sob@harvard.edu" title="Harvard University">Bradner, S.</a>, "<a href="http://tools.ietf.org/html/rfc2119">Key words for use in RFCs to Indicate Requirement Levels</a>", BCP 14, RFC 2119, March 1997.</td>
    </tr>
    <tr>
      <td class="reference">
        <b id="RFC6052">[RFC6052]</b>
      </td>
      <td class="top"><a>Bao, C.</a>, <a>Huitema, C.</a>, <a>Bagnulo, M.</a>, <a>Boucadair, M.</a> and <a>X. Li</a>, "<a href="http://tools.ietf.org/html/rfc6052">IPv6 Addressing of IPv4/IPv6 Translators</a>", RFC 6052, October 2010.</td>
    </tr>
    <tr>
      <td class="reference">
        <b id="RFC6145">[RFC6145]</b>
      </td>
      <td class="top"><a>Li, X.</a>, <a>Bao, C.</a> and <a>F. Baker</a>, "<a href="http://tools.ietf.org/html/rfc6145">IP/ICMP Translation Algorithm</a>", RFC 6145, April 2011.</td>
    </tr>
    <tr>
      <td class="reference">
        <b id="RFC6437">[RFC6437]</b>
      </td>
      <td class="top"><a>Amante, S.</a>, <a>Carpenter, B.</a>, <a>Jiang, S.</a> and <a>J. Rajahalme</a>, "<a href="http://tools.ietf.org/html/rfc6437">IPv6 Flow Label Specification</a>", RFC 6437, November 2011.</td>
    </tr>
  </tbody>
</table>
<h1 id="rfc.references.2"><a href="#rfc.references.2">10.2.</a> Informative References</h1>
<table>
  <tbody>
    <tr>
      <td class="reference">
        <b id="I-D.anderson-v6ops-siit-dc-2xlat">[I-D.anderson-v6ops-siit-dc-2xlat]</b>
      </td>
      <td class="top"><a>tore, t.</a>, "<a href="http://tools.ietf.org/html/draft-anderson-v6ops-siit-dc-2xlat-00">SIIT-DC: Dual Translation Mode</a>", Internet-Draft draft-anderson-v6ops-siit-dc-2xlat-00, September 2014.</td>
    </tr>
    <tr>
      <td class="reference">
        <b id="I-D.gont-6man-deprecate-atomfrag-generation">[I-D.gont-6man-deprecate-atomfrag-generation]</b>
      </td>
      <td class="top"><a>Gont, F.</a>, <a>Will, W.</a> and <a>t. tore</a>, "<a href="http://tools.ietf.org/html/draft-gont-6man-deprecate-atomfrag-generation-01">Deprecating the Generation of IPv6 Atomic Fragments</a>", Internet-Draft draft-gont-6man-deprecate-atomfrag-generation-01, August 2014.</td>
    </tr>
    <tr>
      <td class="reference">
        <b id="I-D.taylor-v6ops-fragdrop">[I-D.taylor-v6ops-fragdrop]</b>
      </td>
      <td class="top"><a>Jaeggli, J.</a>, <a>Colitti, L.</a>, <a>Kumari, W.</a>, <a>Vyncke, E.</a>, <a>Kaeo, M.</a> and <a>T. Taylor</a>, "<a href="http://tools.ietf.org/html/draft-taylor-v6ops-fragdrop-02">Why Operators Filter Fragments and What It Implies</a>", Internet-Draft draft-taylor-v6ops-fragdrop-02, December 2013.</td>
    </tr>
    <tr>
      <td class="reference">
        <b id="RFC0959">[RFC0959]</b>
      </td>
      <td class="top"><a title="Information Sciences Institute (ISI)">Postel, J.</a> and <a>J. Reynolds</a>, "<a href="http://tools.ietf.org/html/rfc959">File Transfer Protocol</a>", STD 9, RFC 959, October 1985.</td>
    </tr>
    <tr>
      <td class="reference">
        <b id="RFC1918">[RFC1918]</b>
      </td>
      <td class="top"><a href="mailto:yakov@cisco.com" title="Cisco systems">Rekhter, Y.</a>, <a href="mailto:rgm3@is.chrysler.com" title="Chrysler Corporation">Moskowitz, R.</a>, <a href="mailto:Daniel.Karrenberg@ripe.net" title="RIPE Network Coordination Centre">Karrenberg, D.</a>, <a href="mailto:GeertJan.deGroot@ripe.net" title="RIPE Network Coordination Centre">Groot, G.</a> and <a href="mailto:lear@sgi.com" title="Silicon Graphics, Inc.">E. Lear</a>, "<a href="http://tools.ietf.org/html/rfc1918">Address Allocation for Private Internets</a>", BCP 5, RFC 1918, February 1996.</td>
    </tr>
    <tr>
      <td class="reference">
        <b id="RFC2373">[RFC2373]</b>
      </td>
      <td class="top"><a href="mailto:hinden@iprg.nokia.com" title="Nokia">Hinden, R.</a> and <a href="mailto:deering@cisco.com" title="Cisco Systems, Inc.">S. Deering</a>, "<a href="http://tools.ietf.org/html/rfc2373">IP Version 6 Addressing Architecture</a>", RFC 2373, July 1998.</td>
    </tr>
    <tr>
      <td class="reference">
        <b id="RFC2460">[RFC2460]</b>
      </td>
      <td class="top"><a href="mailto:deering@cisco.com" title="Cisco Systems, Inc.">Deering, S.</a> and <a href="mailto:hinden@iprg.nokia.com" title="Nokia">R. Hinden</a>, "<a href="http://tools.ietf.org/html/rfc2460">Internet Protocol, Version 6 (IPv6) Specification</a>", RFC 2460, December 1998.</td>
    </tr>
    <tr>
      <td class="reference">
        <b id="RFC2616">[RFC2616]</b>
      </td>
      <td class="top"><a href="mailto:fielding@ics.uci.edu" title="Department of Information and Computer Science">Fielding, R.</a>, <a href="mailto:jg@w3.org" title="World Wide Web Consortium">Gettys, J.</a>, <a href="mailto:mogul@wrl.dec.com" title="Compaq Computer Corporation">Mogul, J.</a>, <a href="mailto:frystyk@w3.org" title="World Wide Web Consortium">Frystyk, H.</a>, <a href="mailto:masinter@parc.xerox.com" title="Xerox Corporation">Masinter, L.</a>, <a href="mailto:paulle@microsoft.com" title="Microsoft Corporation">Leach, P.</a> and <a href="mailto:timbl@w3.org" title="World Wide Web Consortium">T. Berners-Lee</a>, "<a href="http://tools.ietf.org/html/rfc2616">Hypertext Transfer Protocol -- HTTP/1.1</a>", RFC 2616, June 1999.</td>
    </tr>
    <tr>
      <td class="reference">
        <b id="RFC2663">[RFC2663]</b>
      </td>
      <td class="top"><a href="mailto:srisuresh@lucent.com" title="Lucent Technologies">Srisuresh, P.</a> and <a href="mailto:holdrege@lucent.com" title="Lucent Technologiesv">M. Holdrege</a>, "<a href="http://tools.ietf.org/html/rfc2663">IP Network Address Translator (NAT) Terminology and Considerations</a>", RFC 2663, August 1999.</td>
    </tr>
    <tr>
      <td class="reference">
        <b id="RFC2991">[RFC2991]</b>
      </td>
      <td class="top"><a>Thaler, D.</a> and <a>C. Hopps</a>, "<a href="http://tools.ietf.org/html/rfc2991">Multipath Issues in Unicast and Multicast Next-Hop Selection</a>", RFC 2991, November 2000.</td>
    </tr>
    <tr>
      <td class="reference">
        <b id="RFC2993">[RFC2993]</b>
      </td>
      <td class="top"><a>Hain, T.</a>, "<a href="http://tools.ietf.org/html/rfc2993">Architectural Implications of NAT</a>", RFC 2993, November 2000.</td>
    </tr>
    <tr>
      <td class="reference">
        <b id="RFC3022">[RFC3022]</b>
      </td>
      <td class="top"><a>Srisuresh, P.</a> and <a>K. Egevang</a>, "<a href="http://tools.ietf.org/html/rfc3022">Traditional IP Network Address Translator (Traditional NAT)</a>", RFC 3022, January 2001.</td>
    </tr>
    <tr>
      <td class="reference">
        <b id="RFC3235">[RFC3235]</b>
      </td>
      <td class="top"><a>Senie, D.</a>, "<a href="http://tools.ietf.org/html/rfc3235">Network Address Translator (NAT)-Friendly Application Design Guidelines</a>", RFC 3235, January 2002.</td>
    </tr>
    <tr>
      <td class="reference">
        <b id="RFC4213">[RFC4213]</b>
      </td>
      <td class="top"><a>Nordmark, E.</a> and <a>R. Gilligan</a>, "<a href="http://tools.ietf.org/html/rfc4213">Basic Transition Mechanisms for IPv6 Hosts and Routers</a>", RFC 4213, October 2005.</td>
    </tr>
    <tr>
      <td class="reference">
        <b id="RFC4217">[RFC4217]</b>
      </td>
      <td class="top"><a>Ford-Hutchinson, P.</a>, "<a href="http://tools.ietf.org/html/rfc4217">Securing FTP with TLS</a>", RFC 4217, October 2005.</td>
    </tr>
    <tr>
      <td class="reference">
        <b id="RFC6146">[RFC6146]</b>
      </td>
      <td class="top"><a>Bagnulo, M.</a>, <a>Matthews, P.</a> and <a>I. van Beijnum</a>, "<a href="http://tools.ietf.org/html/rfc6146">Stateful NAT64: Network Address and Protocol Translation from IPv6 Clients to IPv4 Servers</a>", RFC 6146, April 2011.</td>
    </tr>
    <tr>
      <td class="reference">
        <b id="RFC6147">[RFC6147]</b>
      </td>
      <td class="top"><a>Bagnulo, M.</a>, <a>Sullivan, A.</a>, <a>Matthews, P.</a> and <a>I. van Beijnum</a>, "<a href="http://tools.ietf.org/html/rfc6147">DNS64: DNS Extensions for Network Address Translation from IPv6 Clients to IPv4 Servers</a>", RFC 6147, April 2011.</td>
    </tr>
    <tr>
      <td class="reference">
        <b id="RFC6540">[RFC6540]</b>
      </td>
      <td class="top"><a>George, W.</a>, <a>Donley, C.</a>, <a>Liljenstolpe, C.</a> and <a>L. Howard</a>, "<a href="http://tools.ietf.org/html/rfc6540">IPv6 Support Required for All IP-Capable Nodes</a>", BCP 177, RFC 6540, April 2012.</td>
    </tr>
    <tr>
      <td class="reference">
        <b id="RFC6946">[RFC6946]</b>
      </td>
      <td class="top"><a>Gont, F.</a>, "<a href="http://tools.ietf.org/html/rfc6946">Processing of IPv6 "Atomic" Fragments</a>", RFC 6946, May 2013.</td>
    </tr>
    <tr>
      <td class="reference">
        <b id="RFC7098">[RFC7098]</b>
      </td>
      <td class="top"><a>Carpenter, B.</a>, <a>Jiang, S.</a> and <a>W. Tarreau</a>, "<a href="http://tools.ietf.org/html/rfc7098">Using the IPv6 Flow Label for Load Balancing in Server Farms</a>", RFC 7098, January 2014.</td>
    </tr>
    <tr>
      <td class="reference">
        <b id="RFC7269">[RFC7269]</b>
      </td>
      <td class="top"><a>Chen, G.</a>, <a>Cao, Z.</a>, <a>Xie, C.</a> and <a>D. Binet</a>, "<a href="http://tools.ietf.org/html/rfc7269">NAT64 Deployment Options and Experience</a>", RFC 7269, June 2014.</td>
    </tr>
  </tbody>
</table>
<h1 id="rfc.appendix.A"><a href="#rfc.appendix.A">Appendix A.</a> Complete SIIT-DC topology example</h1>
<p id="rfc.section.A.p.1">This figure shows a more complete SIIT-DC topology, in order to better demonstrate the beneficial properties it has. In particular, it tries to highlight the following: </p>
<p/>

<ul>
  <li>Stateless operation: Any number of SIIT-DC Gateways may be deployed side-by side, or indeed anywhere in the IPv6 network, as any standard routing mechanism may be used to direct traffic to them (shown here with BGP on the IPv4 side and ECMP on the IPv6 side). This in turn leads to high availability, should one of the SIIT-DC Gateways fail or become unavailable, those standard routing mechanisms will ensure that traffic is automatically redirect one of the remaining SIIT-DC Gateways.</li>
  <li>IPv4 address conservation: Even though the to customers in the example have several hundred servers, most of them are not used for externally available services, and thus do not require an IPv4 address. The network between the servers and the SIIT-DC Gateways require no IPv4 addresses, either. Furthermore, the IPv4 addresses that are used do not have to be assigned to customers in the form of aggregated blocks or prefixes; which makes it easy to achieve 100% effective utilisation of the IPv4 service address pools.</li>
  <li>Application support: The translation-friendly applications HTTP and SMTP will work through SIIT-DC without requiring any special customisation. Furthermore, translation-unfriendly applications such as FTP will also work if an host agent in present, cf.  <a href="#I-D.anderson-v6ops-siit-dc-2xlat">[I-D.anderson-v6ops-siit-dc-2xlat]</a>.</li>
  <li>Native IPv6 as the foundation: Every server, application, and network component has access to native and untranslated IPv6 connectivity to each other and to the Internet. Traffic through the SIIT-DC Gateways will diminish over time as IPv6 is deployed throughout the Internet. Eventually they may be shut down entirely, which causes no disruption to the application stacks' ability to deliver their services over native IPv6.</li>
</ul>

<p> </p>
<div id="rfc.figure.7"/>
<div id="fig_topology"/>
<p/>

<p>Example data centre topology using SIIT-DC</p>
<pre>
                /--------------------------------\ /---------------\
                |          IPv4 Internet         | | IPv6 Internet |
                \-+----------------------------+-/ \--------+------/
                  |                            |            |
                  | &lt;----------[BGP]---------&gt; |            |
                  |                            |            |
+---------&lt;192.0.2.0/24&gt;----------+ +---&lt;192.0.2.0/24&gt;---+  |
|                                 | |                    |  |
|        SIIT-DC Gateway 1        | | SIIT-DC Gateway 2  |  |
|        =================        | | =================  |  |
|                                 | |                    |  |
|       Translation Prefix:       | |                    |  |
|         2001:db8:46::/96        | |                    |  |
|                                 | |                    |  |
|     Static Address Mappings:    | | Exactly the same   |  |
| 192.0.2.1 &lt;=&gt; 2001:db8:12:34::1 | | configuration as   |  |
| 192.0.2.2 &lt;=&gt; 2001:db8:12:34::2 | | SIIT-DC Gateway 1  |  |
| 192.0.2.3 &lt;=&gt; 2001:db8:fe:dc::1 | |                    |  |
| 192.0.2.4 &lt;=&gt; 2001:db8:12:34::4 | |                    |  |
| [...]                           | |                    |  |
|                                 | |                    |  |
+--------&lt;2001:db8:46::/96&gt;-------+ +-&lt;2001:db8:46::/96&gt;-+  |
                  |                            |            |
                  | &lt;---------[ECMP]---------&gt; |            |
                  |                            |            |
/-----------------+----------------------------+-\          |
|            IPv6 data centre network            +----------+
\-+-----------------------------------+----------/
  |                                   |
  | Customer A's server LAN           | Customer B's server LAN
  | 2001:db8:12:34::/64               | 2001:db8:fe:dc::/64
  |                                   |
  |                                   |
  +-- www      ::1 (IPv6+SIIT-DC)     +-- www ::1 (IPv6+SIIT-DC)
  |                                   |
  |                                   +-- file01 ::f:01 (IPv6)
  +-- mta      ::2 (IPv6+SIIT-DC)     |   [...]                
  |                                   +-- file99 ::f:99 (IPv6) 
  +-- ftp      ::3 (IPv6)             
  |            ::4 (SIIT-DC/Host Agent)
  |                                   
  +-- app01 ::a:01 (IPv6)
  |   [...]
  +-  app99 ::a:99 (IPv6)
  |
  +-- db01  ::d:01 (IPv6)
  |   [..]
  +-- db99  ::d:99 (IPv6)
        </pre>
<p class="figure">Figure 7</p>
<h1 id="rfc.appendix.B"><a href="#rfc.appendix.B">Appendix B.</a> Comparison to Other Deployment Approaches</h1>
<p id="rfc.section.B.p.1">There are a number of alternative deployment strategies a data centre operator may follow. They each have different properties and helps solve a different set of challenges. This section aims to compare the SIIT-DC approach with each of the most common ones, by highlighting the benefits and disadvantages of each.  </p>
<h1 id="rfc.appendix.B.1"><a href="#rfc.appendix.B.1">B.1.</a> IPv4-only</h1>
<p id="rfc.section.B.1.p.1">At the time of writing, IPv4-only operation remains the status quo for most operators. As such, it is well understood and supported. An operator can reasonably expect everything to work correctly in an IPv4-only environment.  </p>
<p id="rfc.section.B.1.p.2">Benefits of IPv4-only operation compared to SIIT-DC include: </p>
<p/>

<ul>
  <li>No translation occurs, the end-to-end principle is intact.</li>
  <li>Compatible with all common application protocols.</li>
  <li>Compatible with IPv4-only devices.</li>
  <li>Compatible with IPv4-only application software, without requiring a host agent.</li>
</ul>

<p> </p>
<p id="rfc.section.B.1.p.4">Disadvantages of IPv4-only operation compared to SIIT-DC include: </p>
<p/>

<ul>
  <li>Does not provide any form of IPv6 connectivity.</li>
  <li>Does not alleviate IPv4 address scarcity.</li>
</ul>

<p> </p>
<h1 id="rfc.appendix.B.2"><a href="#rfc.appendix.B.2">B.2.</a> IPv4-only + NAPT44</h1>
<p id="rfc.section.B.2.p.1">An operator who would otherwise chose a traditional IPv4-only approach, but cannot due to having insufficient public IPv4 addresses available, could chose to deploy using a combination of <a href="#RFC1918">private IPv4 addresses</a> <cite title="NONE">[RFC1918]</cite> and <a href="#RFC3022">NAPT44</a> <cite title="NONE">[RFC3022]</cite> devices which will translate between a smaller number of public IPv4 addresses and the private addresses assigned to the servers that provide public services to the Internet.  </p>
<p id="rfc.section.B.2.p.2">Benefits of IPv4-only + NAPT44 operation compared to SIIT-DC include: </p>
<p/>

<ul>
  <li>Compatible with IPv4-only devices.</li>
  <li>Compatible with IPv4-only application software, without requiring a host agent.</li>
</ul>

<p> </p>
<p id="rfc.section.B.2.p.4">Disadvantages of IPv4-only + NAPT44 operation compared to SIIT-DC include: </p>
<p/>

<ul>
  <li>Does not provide any form of IPv6 availability.</li>
  <li>Requires network devices that track all flow state, which may create a performance bottleneck and be an easy target for Denial of Service attacks.</li>
  <li>Limits routing flexibility (prevents closest exit routing), as outbound traffic must pass across the same NAPT44 device that handled the inbound traffic.</li>
  <li>Limited potential for horizontal scaling, as packets cannot be load-balanced across multiple NAT devices.</li>
  <li>Depending on whether or not the NAPT44 device rewrites source addresses in order to attract the return traffic to itself: </li>
  <li>
    <ul>
      <li>Obscures the true source address of the user from the server/application, preventing it from e.g. performing geo-location lookups, or:</li>
      <li>Requires an IPv4 default route to be pointed to the NAPT44 device, also attracting native traffic that does not need to undergo translation.</li>
    </ul>
    <p> </p>
  </li>
</ul>

<p> </p>
<p id="rfc.section.B.2.p.6">In addition, application compatibility is a consideration with both NAPT44 and SIIT-DC, but the exact nature depends from application to application, so it is hard to objectively quantify if there is a clear advantage to either approach here. Some translation-unfriendly application protocols may work without host modifications through the use of Application Layer Gateway support in the NAPT44 device (e.g., <a href="#RFC0959">FTP</a> <cite title="NONE">[RFC0959]</cite>), or in the SIIT-DC architecture when a host agent is being used <a href="#I-D.anderson-v6ops-siit-dc-2xlat">[I-D.anderson-v6ops-siit-dc-2xlat]</a>.  Other application protocols might not work with NAPT44 at all, but will work in the SIIT-DC if a host agent is being used (e.g., <a href="#RFC4217">FTP/TLS</a> <cite title="NONE">[RFC4217]</cite>).  </p>
<p id="rfc.section.B.2.p.7">In summary, the most accurate statement would be to say that a NAPT44 architecture is more compatible with translation-unfriendly protocols than plain SIIT-DC, while SIIT-DC is more compatible than NAPT44 if a host agent is used.  </p>
<p id="rfc.section.B.2.p.8">For a more complete discussion of potential issues with running NAPT44, see <a href="#RFC2993">Architectural Implications of NAT</a> <cite title="NONE">[RFC2993]</cite>.  </p>
<h1 id="rfc.appendix.B.3"><a href="#rfc.appendix.B.3">B.3.</a> IPv4-only + NAT64</h1>
<p id="rfc.section.B.3.p.1">An operator who would otherwise chose a traditional IPv4-only approach, but would in addition like to provide service availability for IPv6 end users, could use <a href="#RFC6146">Stateful NAT64</a> <cite title="NONE">[RFC6146]</cite> to accomplish this. In a sense, this would be the mirror image of an SIIT-DC architecture: The infrastructure and servers remains single-stacked, while connectivity to the other IP stack is provided through a translation system. Further information about operating Stateful NAT64 is found in <a href="#RFC7269">[RFC7269]</a>.  </p>
<p id="rfc.section.B.3.p.2">Note that tateful NAT64 can be deployed with our without NAPT44. With the exception that IPv6 service availability is being provided, the discussion in the previous two sections fully applies to an IPv4-only environment that includes NAT64.  </p>
<p id="rfc.section.B.3.p.3">Benefits of IPv4-only + NAT64 operation compared to SIIT-DC include: </p>
<p/>

<ul>
  <li>Compatible with IPv4-only devices.</li>
  <li>Compatible with IPv4-only application software, without requiring a host agent.</li>
</ul>

<p> </p>
<p id="rfc.section.B.3.p.5">Disadvantages of IPv4-only + NAT64 operation compared to SIIT-DC include: </p>
<p/>

<ul>
  <li>Does not alleviate IPv4 address scarcity (assuming NAPT44 isn't used).</li>
  <li>Requires network devices that track all flow state, which may create a performance bottleneck and be an easy target for Denial of Service attacks.</li>
  <li>Limits routing flexibility (prevents closest exit routing), as outbound traffic must pass across the same NAT64 device that handled the inbound traffic.</li>
  <li>Limited potential for horizontal scaling, as packets cannot be load-balanced across multiple NAT devices.</li>
  <li>Obscures the true source address of the user from the server/application, preventing it from e.g. performing geo-location lookups.</li>
  <li>Continued deployment of IPv6 to Internet users will cause the load levels on the Stateful NAT64 routers to increase. For this reason, <a href="#RFC7269">Section 3.2 of RFC7269</a> <cite title="NONE">[RFC7269]</cite> notes that the use of Stateful NAT64 in a data centre environment "is only reasonable at an early stage".</li>
</ul>

<p> </p>
<h1 id="rfc.appendix.B.4"><a href="#rfc.appendix.B.4">B.4.</a> Dual Stack</h1>
<p><a href="#RFC4213">Dual Stack</a> <cite title="NONE">[RFC4213]</cite> could be used both with or without NAPT44 to handle IPv4. In general, the benefits and disadvantages are equal to the corresponding IPv4-only option, except for the fact that Dual Stack does provides IPv6 connectivity.  Therefore, his section only lists the benefits and disadvantages which are unique to a Dual Stack environment.  </p>
<p id="rfc.section.B.4.p.2">Benefits of Dual Stack operation compared to SIIT-DC include: </p>
<p/>

<ul>
  <li>No translation occurring, the end-to-end principle is intact (assuming NAPT44 isn't used).</li>
  <li>Compatible with all common application protocols (assuming NAPT44 isn't used).</li>
  <li>Compatible with IPv4-only devices.</li>
  <li>Compatible with IPv4-only application software, without requiring a host agent.</li>
</ul>

<p> </p>
<p id="rfc.section.B.4.p.4">Disadvantages of Dual Stack operation compared to SIIT-DC include: </p>
<p/>

<ul>
  <li>Does not alleviate IPv4 address scarcity (assuming NAPT44 isn't used).</li>
  <li>Increases the complexity of the infrastructure, as many things must done twice (once for IPv4 and once for IPv6). Examples of things that must be duplicated in this manner under Dual Stack: Firewall rules/ACLs, IGP topology, monitoring, troubleshooting.</li>
  <li>Encourages software developers, systems administrators, etc. to build architectures that cannot operate correctly without IPv4. This in turn makes it difficult to make use of Dual Stack as a short term transitional stage, rather than a near-permanent end state.</li>
  <li>Increases the amount of things that can encounter failures, and increases the time required to locate and fix such failures. This reduces reliability.</li>
</ul>

<p> </p>
<h1 id="rfc.authors">
  <a href="#rfc.authors">Author's Address</a>
</h1>
<div class="avoidbreak">
  <address class="vcard">
	<span class="vcardline">
	  <span class="fn">Tore Anderson</span> 
	  <span class="n hidden">
		<span class="family-name">Anderson</span>
	  </span>
	</span>
	<span class="org vcardline">Redpill Linpro</span>
	<span class="adr">
	  <span>Vitaminveien 1A</span>

	  <span class="vcardline">
		<span class="locality">0485 Oslo</span>,  
		<span class="region"></span>
		<span class="code"></span>
	  </span>
	  <span class="country-name vcardline">NORWAY</span>
	</span>
	<span class="vcardline">Phone: +47 959 31 212</span>

<span class="vcardline">EMail: <a href="mailto:tore@redpill-linpro.com">tore@redpill-linpro.com</a></span>

  </address>
</div>

</body>
</html>